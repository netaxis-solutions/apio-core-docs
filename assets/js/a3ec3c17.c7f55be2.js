"use strict";(self.webpackChunkapio_core=self.webpackChunkapio_core||[]).push([[7324],{22700:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>l});var s=o(85893),r=o(11151);const t={sidebar_position:1},a="Setup",i={id:"administration/setup",title:"Setup",description:"Requirements",source:"@site/docs/administration/setup.md",sourceDirName:"administration",slug:"/administration/setup",permalink:"/apio-core-docs/docs/administration/setup",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Administration",permalink:"/apio-core-docs/docs/category/administration"},next:{title:"Server configuration",permalink:"/apio-core-docs/docs/administration/server_configuration"}},c={},l=[{value:"Requirements",id:"requirements",level:2},{value:"Installation",id:"installation",level:2},{value:"docker-compose",id:"docker-compose",level:3},{value:"Scheduler",id:"scheduler",level:4},{value:"Webhooks",id:"webhooks",level:4},{value:"Webex Gateway",id:"webex-gateway",level:4},{value:"rsyslog",id:"rsyslog",level:3},{value:"logrotate",id:"logrotate",level:3},{value:"Time to start",id:"time-to-start",level:2},{value:"The Docker way",id:"the-docker-way",level:3},{value:"Create the first superuser",id:"create-the-first-superuser",level:2},{value:"The Docker way",id:"the-docker-way-1",level:3},{value:"Put the instance down",id:"put-the-instance-down",level:2},{value:"The Docker way",id:"the-docker-way-2",level:3},{value:"Restart the instance",id:"restart-the-instance",level:2},{value:"The Docker way",id:"the-docker-way-3",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"setup",children:"Setup"}),"\n",(0,s.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,s.jsx)(n.p,{children:"APIO core platform is a set of microservices that can be deployed on a single server or on multiple servers."}),"\n",(0,s.jsx)(n.p,{children:"The following requirements are for a single server deployment:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"4 CPU cores"}),"\n",(0,s.jsx)(n.li,{children:"16 GB RAM"}),"\n",(0,s.jsx)(n.li,{children:"50 GB disk space"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,s.jsx)(n.p,{children:"You can install APIO core platform on multiple ways:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Using ",(0,s.jsx)(n.a,{href:"#docker-compose",children:"docker-compose"})," with the official ",(0,s.jsx)(n.a,{href:"https://",children:"docker images"})]}),"\n",(0,s.jsxs)(n.li,{children:["Using ",(0,s.jsx)(n.a,{href:"#deb-packages",children:"deb packages"})]}),"\n",(0,s.jsxs)(n.li,{children:["Using ",(0,s.jsx)(n.a,{href:"#rpm-packages",children:"rpm packages"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"docker-compose",children:"docker-compose"}),"\n",(0,s.jsxs)(n.p,{children:["The below ",(0,s.jsx)(n.a,{href:"https://docs.docker.com/compose/",children:"docker-compose"})," configuration can be used to start an APIO core server with a single proxy."]}),"\n",(0,s.jsxs)(n.p,{children:["It relies on a number of environment variables that you must set before running ",(0,s.jsx)(n.code,{children:"docker-compose up"}),". The variables are described below."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'# docker-compose.yml\nversion: \'3\'\n\nservices:\n  nginx:\n    image: nginx:latest\n    restart: always\n    ports:\n      - "80:80"\n    volumes:\n      - static-files:/www/\n      - ./etc/nginx.conf:/etc/nginx/conf.d/default.conf\n      - /var/log/nginx:/var/log/nginx\n    logging:\n      driver: syslog\n      options:\n        tag: "{{.Name}}"\n\n  core:\n    image: docker.bxl.netaxis.be/apio_bsft/core:2.14.0\n    command: /usr/local/go/server -workflows -port=5000 -host=0.0.0.0 -cleanup\n    restart: always\n    environment:\n      - DB=postgres://<username>:<password>@<hostname>:<port>/<database>\n      - VIRTUAL_ENV=/opt/apio_core\n    volumes:\n      - static-files:/usr/local/www/\n      - /var/log/apio:/var/log/apio\n    logging:\n      driver: syslog\n      options:\n        tag: "{{.Name}}"\n\n  p1:\n    image: docker.bxl.netaxis.be/apio_bsft/core:2.14.0\n    command: /usr/local/go/server -workflows -port=5000 -host=0.0.0.0 -proxy=/api/v01/p1:bwks\n    restart: always\n    environment:\n      - DB=postgres://<username>:<password>@<hostname>:<port>/<database>\n      - VIRTUAL_ENV=/opt/apio_core\n    logging:\n      driver: syslog\n      options:\n        tag: "{{.Name}}"\n\nvolumes:\n    static-www:\n'})}),"\n",(0,s.jsx)(n.p,{children:"If processes run nodes like docker containers they require access to the host machine's Docker daemon:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# docker-compose.yml\nversion: '3'\n\nservices:\n  [...]\n  apio:\n    [...]\n+   volumes:\n+     - /var/run/docker.sock:/var/run/docker.sock\n\n  px1:\n    [...]\n+   volumes:\n+     - /var/run/docker.sock:/var/run/docker.sock\n"})}),"\n",(0,s.jsx)(n.h4,{id:"scheduler",children:"Scheduler"}),"\n",(0,s.jsx)(n.p,{children:"If the platform needs to run recurrent jobs or timers, the scheduler service must be started:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# docker-compose.yml\nversion: '3'\n\nservices:\n  [...]\n  scheduler:\n    image: docker.bxl.netaxis.be/apio_bsft/core:2.14.0\n    command: /usr/local/go/scheduler\n    restart: always\n    environment:\n      - SCH_DB=postgres://<username>:<password>@<hostname>:<port>/<database>\n      - VIRTUAL_ENV=/opt/apio_core\n    logging:\n      driver: syslog\n      options:\n        tag: \"{{.Name}}\"\n"})}),"\n",(0,s.jsx)(n.h4,{id:"webhooks",children:"Webhooks"}),"\n",(0,s.jsx)(n.p,{children:"If the platform needs to trigger webhooks, the webhook service must be started:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# docker-compose.yml\nversion: '3'\n\nservices:\n  [...]\n  webhooks:\n    image: docker.bxl.netaxis.be/apio_bsft/core:2.14.0\n    command: /usr/local/go/webhooks\n    restart: always\n    environment:\n      - WHK_DB=postgres://<username>:<password>@<hostname>:<port>/<database>\n    extra_hosts:\n      - host.docker.internal:host-gateway\n    logging:\n      driver: syslog\n      options:\n        tag: \"{{.Name}}\"\n"})}),"\n",(0,s.jsx)(n.h4,{id:"webex-gateway",children:"Webex Gateway"}),"\n",(0,s.jsx)(n.p,{children:"If the platform needs to interact with a Webex Teams API, the webex gateway service must be started:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# docker-compose.yml\nversion: '3'\n\nservices:\n  [...]\n  webex_gw:\n    image: docker.bxl.netaxis.be/apio_bsft/core:2.14.0\n    command: /usr/local/go/webex_gw -port=9001 -tokensFile=/opt/tokens/.tokens\n    restart: always\n    environment:\n      - client_id=<client_id>\n      - client_secret=<client_secret>\n      - redirect_uri=https://<apio-core-host>/api/v01/webex/auth/code\n    expose:\n      - 9001\n    volumes:\n      - /opt/webex_gw:/opt/tokens\n    logging:\n      driver: syslog\n      options:\n        tag: \"{{.Name}}\"\n"})}),"\n",(0,s.jsx)(n.h3,{id:"rsyslog",children:"rsyslog"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$FileCreateMode 0644\n\nif $syslogtag contains 'apio_core_p1' then \\\n  /var/log/apio/px1n.log\n  &stop\n\nif $syslogtag contains 'apio_core_core' then \\\n  /var/log/apio/core.log\n  &stop\n\nif $syslogtag contains 'apio_core_webhooks' then \\\n  /var/log/apio/webhooks.log\n  &stop\n\nif $syslogtag contains 'apio_core_webex_gw' then \\\n  /var/log/apio/webex_gw.log\n  &stop\n\nif $syslogtag contains 'apio_core_scheduler' then \\\n  /var/log/apio/scheduler.log\n  &stop\n\n$FileCreateMode 0644\n"})}),"\n",(0,s.jsx)(n.h3,{id:"logrotate",children:"logrotate"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"/var/log/apio/*.log\n{\n       missingok\n       daily\n       rotate 30\n       notifempty\n       copytruncate\n       compress\n}\n\n/var/log/nginx/*.log\n{\n\tmissingok\n\tdaily\n\trotate 20\n\tnotifempty\n\tcopytruncate\n\tcompress\n\tdelaycompress\n\tsharedscripts\n\tpostrotate\n\t\tdocker-compose -f /opt/apio_core/docker-compose.yml exec nginx nginx -s reload\n\tendscript\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"time-to-start",children:"Time to start"}),"\n",(0,s.jsx)(n.h3,{id:"the-docker-way",children:"The Docker way"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"$ docker-compose up -d\n"})}),"\n",(0,s.jsx)(n.h2,{id:"create-the-first-superuser",children:"Create the first superuser"}),"\n",(0,s.jsx)(n.p,{children:"When the APIO core platform is started for the first time, you must create the first user. This user will be the administrator of the platform."}),"\n",(0,s.jsx)(n.h3,{id:"the-docker-way-1",children:"The Docker way"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"$ docker-compose run --rm core /usr/local/go/server -newsuperuser\n"})}),"\n",(0,s.jsx)(n.p,{children:"By default the username is 'netaxis'."}),"\n",(0,s.jsx)(n.admonition,{type:"caution",children:(0,s.jsx)(n.p,{children:"The password is automatically generated and displayed in the console. You must copy it and store it in a safe place."})}),"\n",(0,s.jsx)(n.h2,{id:"put-the-instance-down",children:"Put the instance down"}),"\n",(0,s.jsx)(n.h3,{id:"the-docker-way-2",children:"The Docker way"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"$ docker-compose down -v\n"})}),"\n",(0,s.jsx)(n.h2,{id:"restart-the-instance",children:"Restart the instance"}),"\n",(0,s.jsx)(n.h3,{id:"the-docker-way-3",children:"The Docker way"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"$ docker-compose down -v; docker-compose up -d\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},11151:(e,n,o)=>{o.d(n,{a:()=>a});var s=o(67294);const r={},t=s.createContext(r);function a(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}}}]);