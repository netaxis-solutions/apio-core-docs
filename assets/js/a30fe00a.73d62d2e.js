"use strict";(self.webpackChunkapio_core=self.webpackChunkapio_core||[]).push([[63],{24274:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>l,frontMatter:()=>o,metadata:()=>r,toc:()=>d});var n=a(85893),s=a(11151);const o={sidebar_position:5},i="Database",r={id:"administration/database",title:"Database",description:"Setup",source:"@site/docs/administration/database.md",sourceDirName:"administration",slug:"/administration/database",permalink:"/apio-core-docs/docs/administration/database",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Templates",permalink:"/apio-core-docs/docs/administration/templates"},next:{title:"Users",permalink:"/apio-core-docs/docs/administration/users"}},c={},d=[{value:"Setup",id:"setup",level:2},{value:"Replication",id:"replication",level:2},{value:"Backup",id:"backup",level:2},{value:"Restore",id:"restore",level:2}];function p(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,s.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"database",children:"Database"}),"\n",(0,n.jsx)(t.h2,{id:"setup",children:"Setup"}),"\n",(0,n.jsx)(t.p,{children:"APIO core software requires a PostgreSQL database to store its data."}),"\n",(0,n.jsx)(t.p,{children:"The database can be installed on the same server as the APIO core software or on a different server. In the first case, it will require a dedicated mount endpoint to store its data. In the latter case, the database must be accessible from the APIO core software server."}),"\n",(0,n.jsxs)(t.p,{children:["We recommend the usage of the ",(0,n.jsx)(t.a,{href:"https://hub.docker.com/r/bitnami/postgresql",children:"bitnami PostgreSQL docker image"})," to run the database. The documentation can be found ",(0,n.jsx)(t.a,{href:"https://github.com/bitnami/containers/tree/main/bitnami/postgresql#how-to-use-this-image",children:"here"}),"."]}),"\n",(0,n.jsx)(t.admonition,{type:"caution",children:(0,n.jsxs)(t.p,{children:["APIO core requires the database to be set with the ",(0,n.jsx)(t.code,{children:"ETC/UTC"})," timezone. Docker images provided by bitnami are already set with this timezone. If your setup is different, ensure the timezone is set correctly (command ",(0,n.jsx)(t.code,{children:"SHOW TIMEZONE"}),")"]})}),"\n",(0,n.jsx)(t.h2,{id:"replication",children:"Replication"}),"\n",(0,n.jsxs)(t.p,{children:["Postgresql support streaming replication and the image provided by bitnami support it. The documentation can be found ",(0,n.jsx)(t.a,{href:"https://github.com/bitnami/containers/tree/main/bitnami/postgresql#setting-up-a-streaming-replication",children:"here"}),"."]}),"\n",(0,n.jsx)(t.admonition,{type:"caution",children:(0,n.jsx)(t.p,{children:"The replicate(s) are not actually used by the APIO core software. But we highly recommend to setup a replication to avoid data loss."})}),"\n",(0,n.jsx)(t.h2,{id:"backup",children:"Backup"}),"\n",(0,n.jsxs)(t.p,{children:["APIO core software doesn't provide any backup feature. However, it is possible to backup the data stored in the database by using the ",(0,n.jsx)(t.code,{children:"pg_dump"})," command."]}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"pg_dump"})," command can be used to backup the database. The following command will create a backup file of the database:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"pg_dump -U postgres -h localhost -p 5432 -d apio > /backups/backup_$(date +%Y%m%d%H%M%S).sql\n\n# or with gzip compression\npg_dump -U postgres -h localhost -p 5432 -d apio | gzip > /backups/backup_$(date +%Y%m%d%H%M%S).sql.gz\n\n# if postgresql is running on docker, do not run the command in the container, but on the host machine (or another machine)\ndocker compose run --rm postgres pg_dump -U postgres -h localhost -p 5432 -d apio > /backups/backup_$(date +%Y%m%d%H%M%S).sql\n"})}),"\n",(0,n.jsx)(t.admonition,{type:"info",children:(0,n.jsx)(t.p,{children:"The backup doesn't require to stop the APIO core software."})}),"\n",(0,n.jsx)(t.admonition,{type:"caution",children:(0,n.jsx)(t.p,{children:"The backup file can be very large. It is recommended to compress it.\nIf the database runs on a docker container, avoid generating the backup file in the container."})}),"\n",(0,n.jsx)(t.h2,{id:"restore",children:"Restore"}),"\n",(0,n.jsxs)(t.p,{children:["Whilst the APIO core software is ",(0,n.jsx)(t.a,{href:"setup#put-the-instance-down",children:"stopped"}),", the database can be restored from a backup file."]}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"psql"})," command can be used to restore the database. The following command will restore the database from a backup file:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"psql -U postgres -h localhost -p 5432 -d apio < /backups/backup_20210101120000.sql\n\n# or with gzip compression\ngunzip -c /backups/backup_20210101120000.sql.gz | psql -U postgres -h localhost -p 5432 -d apio\n"})})]})}function l(e={}){const{wrapper:t}={...(0,s.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(p,{...e})}):p(e)}},11151:(e,t,a)=>{a.d(t,{Z:()=>r,a:()=>i});var n=a(67294);const s={},o=n.createContext(s);function i(e){const t=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);