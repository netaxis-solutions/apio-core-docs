"use strict";(self.webpackChunkapio_core=self.webpackChunkapio_core||[]).push([[2026],{68208:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>o,frontMatter:()=>d,metadata:()=>c,toc:()=>h});var r=s(85893),n=s(11151);const d={sidebar_position:2},i="Templates",c={id:"workflows/templates",title:"Templates",description:"Most fields in the nodes can be evaluated as templates. The template engine is Jinja2 and expose all the buit-in's of the language.",source:"@site/docs/workflows/templates.md",sourceDirName:"workflows",slug:"/workflows/templates",permalink:"/apio-core-docs/docs/workflows/templates",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Nodes",permalink:"/apio-core-docs/docs/workflows/nodes"},next:{title:"Zen",permalink:"/apio-core-docs/docs/workflows/zen"}},l={},h=[{value:"Filters",id:"filters",level:2},{value:"Tests",id:"tests",level:2},{value:"Functions",id:"functions",level:2},{value:"Variables",id:"variables",level:2}];function a(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",p:"p",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,n.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h1,{id:"templates",children:"Templates"}),"\n",(0,r.jsxs)(t.p,{children:["Most fields in the nodes can be evaluated as templates. The template engine is ",(0,r.jsx)(t.a,{href:"https://jinja.palletsprojects.com/",children:"Jinja2"})," and expose all the ",(0,r.jsx)(t.a,{href:"https://jinja.palletsprojects.com/en/3.1.x/templates/#list-of-builtin-filters",children:"buit-in's"})," of the language."]}),"\n",(0,r.jsxs)(t.p,{children:["To debug easily such fields, you can use the ",(0,r.jsx)("a",{href:"/../../help/template-playground",target:"_blank",children:"playground"}),"."]}),"\n",(0,r.jsx)(t.p,{children:"It is extended with the following elements."}),"\n",(0,r.jsx)(t.h2,{id:"filters",children:"Filters"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.a,{href:"https://jinja.palletsprojects.com/en/3.1.x/templates/#list-of-builtin-filters",children:"From Jinja2"})}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Filter"}),(0,r.jsx)(t.th,{children:"Description"}),(0,r.jsx)(t.th,{children:"Sample"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"pp_dict"}),(0,r.jsx)(t.td,{children:"turn an object into a pretty-printed JSON string representation"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ {'a': 1, 'b': 2} | pp_dict }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"dict_filter"}),(0,r.jsx)(t.td,{children:"filter a dictionary with a set of keys"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ {'a': 1, 'b': 2, 'c': 3} | dict_filter(['a', 'b']) }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"json_query"}),(0,r.jsx)(t.td,{children:"inspect a JSON object with a JMESPath query"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ {'a': 1, 'b': 2, 'c': 3} | json_query('a') }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"url_qs"}),(0,r.jsx)(t.td,{children:"parse a URL query string into a dictionary"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ 'a=1&b=2&c=3' | url_qs }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"url_raw_query"}),(0,r.jsx)(t.td,{children:"parse a URL query string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ 'a=1&b=2&c=3' | url_raw_query }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"json"}),(0,r.jsx)(t.td,{children:"parse a JSON string into a dictionary"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:'{{ \'{"a": 1, "b": 2, "c": 3}\' | json }}'})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"url_path"}),(0,r.jsx)(t.td,{children:"extract the path from a URL"}),(0,r.jsx)(t.td,{children:(0,r.jsxs)("code",{children:["{{ '",(0,r.jsx)(t.a,{href:"http://localhost:8080/api/v01/public/demo",children:"http://localhost:8080/api/v01/public/demo"}),"' | url_path }}"]})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"combine"}),(0,r.jsx)(t.td,{children:"merge dictionaries"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ {'a': 1, 'b': 2} | combine({'c': 3}) }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"rest2dict"}),(0,r.jsxs)(t.td,{children:["parse a REST call response into a dictionary (note: it automatically parse a ",(0,r.jsx)(t.code,{children:"body"})," property as a JSON string into an object)"]}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ rest2dict(rest) }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"regex_replace"}),(0,r.jsx)(t.td,{children:"use a regular expression to replace a string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ 'hello, world' | regex_replace('hello', 'goodbye') }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"regex_findall"}),(0,r.jsx)(t.td,{children:"use a regular expression to find all matches in a string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ 'hello, world' | regex_findall('l') }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"regex_search"}),(0,r.jsx)(t.td,{children:"use a regular expression to search a string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ 'hello, world' | regex_search('l') }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"unique"}),(0,r.jsx)(t.td,{children:"exclude duplicates from a list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ [1, 2, 3, 1, 2, 3] | unique }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"intersect"}),(0,r.jsx)(t.td,{children:"intersect two lists"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ [1, 2, 3] | intersect([2, 3, 4]) }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"difference"}),(0,r.jsx)(t.td,{children:"difference between two lists"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ [1, 2, 3] | difference([2, 3, 4]) }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"union"}),(0,r.jsx)(t.td,{children:"union of two lists"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ [1, 2, 3] | union([2, 3, 4]) }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"min"}),(0,r.jsx)(t.td,{children:"minimum value of a list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ [1, 2, 3] | min }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"max"}),(0,r.jsx)(t.td,{children:"maximum value of a list"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ [1, 2, 3] | max }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"b64encode"}),(0,r.jsx)(t.td,{children:"base64 encode a string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ 'hello, world' | b64encode }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"b64decode"}),(0,r.jsx)(t.td,{children:"base64 decode a string"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ 'aGVsbG8sIHdvcmxk' | b64decode }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"phonenumber_valid"}),(0,r.jsx)(t.td,{children:"check if a phone number is valid"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ '+33612345678' | phonenumber_valid }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"phonenumber_e164"}),(0,r.jsx)(t.td,{children:"convert a phone number to E164 format"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ '+33612345678' | phonenumber_e164 }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"phonenumber_cc"}),(0,r.jsx)(t.td,{children:"extract the country code from a phone number"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ '+33612345678' | phonenumber_cc }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"phonenumber_cca"}),(0,r.jsx)(t.td,{children:"extract the country code from a phone number in alpha-2 format"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ '+33612345678' | phonenumber_cca }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"phonenumber_type"}),(0,r.jsx)(t.td,{children:"extract the type of a phone number"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ '+33612345678' | phonenumber_type }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"strftime"}),(0,r.jsx)(t.td,{children:"format a date"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ '2021-01-01' | strftime('%Y-%m-%d') }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"to_datetime"}),(0,r.jsx)(t.td,{children:"convert a string to a datetime object"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ '2021-01-01' | to_datetime }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"to_bool"}),(0,r.jsx)(t.td,{children:'convert a string to a boolean (evaluate to true: "yes", "on", "1", "true", 1)'}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ 'true' | to_bool }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"hmac"}),(0,r.jsx)(t.td,{children:"generate hash for a string, using a key (optional); supported digests: sha1, sha224, sha256 (default), sha384, sha512, blake2b, blake2s"}),(0,r.jsxs)(t.td,{children:[(0,r.jsx)("code",{children:"{{ 'secret' | hmac }}"}),(0,r.jsx)("br",{}),(0,r.jsx)("code",{children:"{{ 'secret' | hmac('key') }}"}),(0,r.jsx)("br",{}),(0,r.jsx)("code",{children:"{{ 'secret' | hmac('key', 'sha512') }}"})]})]})]})]}),"\n",(0,r.jsx)(t.h2,{id:"tests",children:"Tests"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.a,{href:"https://jinja.palletsprojects.com/en/3.1.x/templates/#list-of-builtin-tests",children:"From Jinja2"})}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Test"}),(0,r.jsx)(t.th,{children:"Description"}),(0,r.jsx)(t.th,{children:"Sample"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"startswith"}),(0,r.jsx)(t.td,{children:"check if a string starts with a substring"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ 'hello, world' | startswith('hello') }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"endswith"}),(0,r.jsx)(t.td,{children:"check if a string ends with a substring"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ 'hello, world' | endswith('world') }}"})})]})]})]}),"\n",(0,r.jsx)(t.h2,{id:"functions",children:"Functions"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Function"}),(0,r.jsx)(t.th,{children:"Description"}),(0,r.jsx)(t.th,{children:"Sample"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"now"}),(0,r.jsx)(t.td,{children:"compute the current date and time"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ now() }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"timedelta"}),(0,r.jsx)(t.td,{children:"apply a delta to a date"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ now() | timedelta(days=1) }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"utcnow"}),(0,r.jsx)(t.td,{children:"compute the current date and time in UTC"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ utcnow() }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"uuid"}),(0,r.jsx)(t.td,{children:"generate a UUID"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ uuid() }}"})})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"randint"}),(0,r.jsx)(t.td,{children:"generate a random integer"}),(0,r.jsx)(t.td,{children:(0,r.jsx)("code",{children:"{{ randint(1, 10) }}"})})]})]})]}),"\n",(0,r.jsx)(t.h2,{id:"variables",children:"Variables"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.a,{href:"https://jinja.palletsprojects.com/en/3.1.x/templates/#assignments",children:"Assignments from Jinja2"})}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Variable"}),(0,r.jsx)(t.th,{children:"Description"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"request"}),(0,r.jsxs)(t.td,{children:["the current request object.",(0,r.jsx)("br",{})," Use ",(0,r.jsx)("code",{children:"{{ (request.body | rest2dict).<property> }}"})," to access request body triggered by an HTTP custom endpoint"]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"instance"}),(0,r.jsxs)(t.td,{children:["the current instance object running a workflow with the following attributes: ",(0,r.jsxs)("ul",{children:[(0,r.jsx)("li",{children:"id"}),(0,r.jsx)("li",{children:"guid"}),(0,r.jsx)("li",{children:"callback_task_id"}),(0,r.jsx)("li",{children:"user_id"}),(0,r.jsx)("li",{children:"original_request_id"}),(0,r.jsx)("li",{children:"label"})]})]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"context"}),(0,r.jsx)(t.td,{children:"a key-value map attached to the current workflow instance"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"tasks"}),(0,r.jsx)(t.td,{children:"tasks ran until there with their status"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"sub_instances_responses"}),(0,r.jsx)(t.td,{children:'"callback" responses produced by sub-instances'})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"parent_instance_context"}),(0,r.jsx)(t.td,{children:"context of the parent instance (only filled in sub-instance)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"settings"}),(0,r.jsx)(t.td,{children:"a dictionary containing the settings of the platform (sensitive content are removed for security reason)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"env"}),(0,r.jsx)(t.td,{children:"a dictionary containing the environment variables of the platform"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"proxy_name"}),(0,r.jsx)(t.td,{children:"the name of the proxy (only filled in processes started with proxy binding)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"worker_env"}),(0,r.jsx)(t.td,{children:"a dictionary containing the environment variables of the worker process (note: it allows to attach different values depending on the running location)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"user"}),(0,r.jsx)(t.td,{children:"the user object of the current user (only filled when the instance has an owner defined)"})]})]})]})]})}function o(e={}){const{wrapper:t}={...(0,n.a)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},11151:(e,t,s)=>{s.d(t,{a:()=>i});var r=s(67294);const n={},d=r.createContext(n);function i(e){const t=r.useContext(d);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}}}]);