"use strict";(self.webpackChunkapio_core=self.webpackChunkapio_core||[]).push([[2026],{68208:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>o,frontMatter:()=>i,metadata:()=>l,toc:()=>h});var n=s(85893),r=s(11151);const i={sidebar_position:2},d="Templates",l={id:"workflows/templates",title:"Templates",description:"Most fields in the nodes can be evaluated as templates. The default template engine is Jinja2 and expose all the buit-in's of the language.",source:"@site/docs/workflows/templates.md",sourceDirName:"workflows",slug:"/workflows/templates",permalink:"/apio-core-docs/docs/workflows/templates",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Nodes",permalink:"/apio-core-docs/docs/workflows/nodes"},next:{title:"Zen",permalink:"/apio-core-docs/docs/workflows/zen"}},c={},h=[{value:"Filters",id:"filters",level:2},{value:"Tests",id:"tests",level:2},{value:"Functions",id:"functions",level:2},{value:"Variables",id:"variables",level:2},{value:"Alternatives",id:"alternatives",level:2},{value:"Pongo2",id:"pongo2",level:3}];function a(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",img:"img",p:"p",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"templates",children:"Templates"}),"\n",(0,n.jsxs)(t.p,{children:["Most fields in the nodes can be evaluated as templates. The default template engine is ",(0,n.jsx)(t.a,{href:"https://jinja.palletsprojects.com/",children:"Jinja2"})," and expose all the ",(0,n.jsx)(t.a,{href:"https://jinja.palletsprojects.com/en/3.1.x/templates/#list-of-builtin-filters",children:"buit-in's"})," of the language."]}),"\n",(0,n.jsxs)(t.p,{children:["To debug easily such fields, you can use the ",(0,n.jsx)("a",{href:"/../../help/template-playground",target:"_blank",children:"playground"}),"."]}),"\n",(0,n.jsx)(t.p,{children:"It is extended with the following elements."}),"\n",(0,n.jsx)(t.h2,{id:"filters",children:"Filters"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.a,{href:"https://jinja.palletsprojects.com/en/3.1.x/templates/#list-of-builtin-filters",children:"From Jinja2"})}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Filter"}),(0,n.jsx)(t.th,{children:"Description"}),(0,n.jsx)(t.th,{children:"Sample"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"pp_dict"}),(0,n.jsx)(t.td,{children:"turn an object into a pretty-printed JSON string representation"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ {'a': 1, 'b': 2} | pp_dict }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"dict_filter"}),(0,n.jsx)(t.td,{children:"filter a dictionary with a set of keys"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ {'a': 1, 'b': 2, 'c': 3} | dict_filter(['a', 'b']) }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"json_query"}),(0,n.jsx)(t.td,{children:"inspect a JSON object with a JMESPath query"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ {'a': 1, 'b': 2, 'c': 3} | json_query('a') }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"url_qs"}),(0,n.jsx)(t.td,{children:"parse a URL query string into a dictionary"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ 'a=1&b=2&c=3' | url_qs }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"url_raw_query"}),(0,n.jsx)(t.td,{children:"parse a URL query string"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ 'a=1&b=2&c=3' | url_raw_query }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"json"}),(0,n.jsx)(t.td,{children:"parse a JSON string into a dictionary"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:'{{ \'{"a": 1, "b": 2, "c": 3}\' | json }}'})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"url_path"}),(0,n.jsx)(t.td,{children:"extract the path from a URL"}),(0,n.jsx)(t.td,{children:(0,n.jsxs)("code",{children:["{{ '",(0,n.jsx)(t.a,{href:"http://localhost:8080/api/v01/public/demo",children:"http://localhost:8080/api/v01/public/demo"}),"' | url_path }}"]})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"combine"}),(0,n.jsx)(t.td,{children:"merge dictionaries"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ {'a': 1, 'b': 2} | combine({'c': 3}) }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"rest2dict"}),(0,n.jsxs)(t.td,{children:["parse a REST call response into a dictionary (note: it automatically parse a ",(0,n.jsx)(t.code,{children:"body"})," property as a JSON string into an object)"]}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ rest2dict(rest) }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"regex_replace"}),(0,n.jsx)(t.td,{children:"use a regular expression to replace a string"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ 'hello, world' | regex_replace('hello', 'goodbye') }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"regex_findall"}),(0,n.jsx)(t.td,{children:"use a regular expression to find all matches in a string"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ 'hello, world' | regex_findall('l') }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"regex_search"}),(0,n.jsx)(t.td,{children:"use a regular expression to search a string"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ 'hello, world' | regex_search('l') }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"unique"}),(0,n.jsx)(t.td,{children:"exclude duplicates from a list"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ [1, 2, 3, 1, 2, 3] | unique }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"intersect"}),(0,n.jsx)(t.td,{children:"intersect two lists"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ [1, 2, 3] | intersect([2, 3, 4]) }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"difference"}),(0,n.jsx)(t.td,{children:"difference between two lists"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ [1, 2, 3] | difference([2, 3, 4]) }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"union"}),(0,n.jsx)(t.td,{children:"union of two lists"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ [1, 2, 3] | union([2, 3, 4]) }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"min"}),(0,n.jsx)(t.td,{children:"minimum value of a list"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ [1, 2, 3] | min }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"max"}),(0,n.jsx)(t.td,{children:"maximum value of a list"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ [1, 2, 3] | max }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"b64encode"}),(0,n.jsx)(t.td,{children:"base64 encode a string"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ 'hello, world' | b64encode }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"b64decode"}),(0,n.jsx)(t.td,{children:"base64 decode a string"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ 'aGVsbG8sIHdvcmxk' | b64decode }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"phonenumber_valid"}),(0,n.jsx)(t.td,{children:"check if a phone number is valid"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ '+33612345678' | phonenumber_valid }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"phonenumber_e164"}),(0,n.jsx)(t.td,{children:"convert a phone number to E164 format"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ '+33612345678' | phonenumber_e164 }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"phonenumber_cc"}),(0,n.jsx)(t.td,{children:"extract the country code from a phone number"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ '+33612345678' | phonenumber_cc }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"phonenumber_cca"}),(0,n.jsx)(t.td,{children:"extract the country code from a phone number in alpha-2 format"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ '+33612345678' | phonenumber_cca }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"phonenumber_type"}),(0,n.jsx)(t.td,{children:"extract the type of a phone number"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ '+33612345678' | phonenumber_type }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"strftime"}),(0,n.jsx)(t.td,{children:"format a date"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ '2021-01-01' | strftime('%Y-%m-%d') }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"to_datetime"}),(0,n.jsx)(t.td,{children:"convert a string to a datetime object"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ '2021-01-01' | to_datetime }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"to_bool"}),(0,n.jsx)(t.td,{children:'convert a string to a boolean (evaluate to true: "yes", "on", "1", "true", 1)'}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ 'true' | to_bool }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"hmac"}),(0,n.jsx)(t.td,{children:"generate hash for a string, using a key (optional); supported digests: sha1, sha224, sha256 (default), sha384, sha512, blake2b, blake2s"}),(0,n.jsxs)(t.td,{children:[(0,n.jsx)("code",{children:"{{ 'secret' | hmac }}"}),(0,n.jsx)("br",{}),(0,n.jsx)("code",{children:"{{ 'secret' | hmac('key') }}"}),(0,n.jsx)("br",{}),(0,n.jsx)("code",{children:"{{ 'secret' | hmac('key', 'sha512') }}"})]})]})]})]}),"\n",(0,n.jsx)(t.h2,{id:"tests",children:"Tests"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.a,{href:"https://jinja.palletsprojects.com/en/3.1.x/templates/#list-of-builtin-tests",children:"From Jinja2"})}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Test"}),(0,n.jsx)(t.th,{children:"Description"}),(0,n.jsx)(t.th,{children:"Sample"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"startswith"}),(0,n.jsx)(t.td,{children:"check if a string starts with a substring"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ 'hello, world' | startswith('hello') }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"endswith"}),(0,n.jsx)(t.td,{children:"check if a string ends with a substring"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ 'hello, world' | endswith('world') }}"})})]})]})]}),"\n",(0,n.jsx)(t.h2,{id:"functions",children:"Functions"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Function"}),(0,n.jsx)(t.th,{children:"Description"}),(0,n.jsx)(t.th,{children:"Sample"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"now"}),(0,n.jsx)(t.td,{children:"compute the current date and time"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ now() }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"timedelta"}),(0,n.jsx)(t.td,{children:"apply a delta to a date"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ now() | timedelta(days=1) }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"utcnow"}),(0,n.jsx)(t.td,{children:"compute the current date and time in UTC"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ utcnow() }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"uuid"}),(0,n.jsx)(t.td,{children:"generate a UUID"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ uuid() }}"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"randint"}),(0,n.jsx)(t.td,{children:"generate a random integer"}),(0,n.jsx)(t.td,{children:(0,n.jsx)("code",{children:"{{ randint(1, 10) }}"})})]})]})]}),"\n",(0,n.jsx)(t.h2,{id:"variables",children:"Variables"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.a,{href:"https://jinja.palletsprojects.com/en/3.1.x/templates/#assignments",children:"Assignments from Jinja2"})}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Variable"}),(0,n.jsx)(t.th,{children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"request"}),(0,n.jsxs)(t.td,{children:["the current request object.",(0,n.jsx)("br",{})," Use ",(0,n.jsx)("code",{children:"{{ (request.body | rest2dict).<property> }}"})," to access request body triggered by an HTTP custom endpoint"]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"instance"}),(0,n.jsxs)(t.td,{children:["the current instance object running a workflow with the following attributes: ",(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:"id"}),(0,n.jsx)("li",{children:"guid"}),(0,n.jsx)("li",{children:"callback_task_id"}),(0,n.jsx)("li",{children:"user_id"}),(0,n.jsx)("li",{children:"original_request_id"}),(0,n.jsx)("li",{children:"label"})]})]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"context"}),(0,n.jsx)(t.td,{children:"a key-value map attached to the current workflow instance"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"tasks"}),(0,n.jsx)(t.td,{children:"tasks ran until there with their status"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"sub_instances_responses"}),(0,n.jsx)(t.td,{children:'"callback" responses produced by sub-instances'})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"parent_instance_context"}),(0,n.jsx)(t.td,{children:"context of the parent instance (only filled in sub-instance)"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"settings"}),(0,n.jsx)(t.td,{children:"a dictionary containing the settings of the platform (sensitive content are removed for security reason)"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"env"}),(0,n.jsx)(t.td,{children:"a dictionary containing the environment variables of the platform"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"proxy_name"}),(0,n.jsx)(t.td,{children:"the name of the proxy (only filled in processes started with proxy binding)"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"worker_env"}),(0,n.jsx)(t.td,{children:"a dictionary containing the environment variables of the worker process (note: it allows to attach different values depending on the running location)"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"user"}),(0,n.jsx)(t.td,{children:"the user object of the current user (only filled when the instance has an owner defined)"})]})]})]}),"\n",(0,n.jsx)(t.h2,{id:"alternatives",children:"Alternatives"}),"\n",(0,n.jsxs)(t.p,{children:["While jinja2 is the default template engine, you can use other engines by specifying the ",(0,n.jsx)(t.code,{children:"engine"})," attribute in the field (just under the template in the editor)."]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"template-engines-alternatives",src:s(27069).Z+"",width:"738",height:"448"})}),"\n",(0,n.jsx)(t.admonition,{type:"tip",children:(0,n.jsxs)(t.p,{children:["Jinja2 is a Python based template engine, so it is the most extensible and powerful engine available.\n",(0,n.jsx)(t.em,{children:"But"})," because it is Python based, it is not the fastest engine available. If you have a lot of templates to evaluate, or templates with big data or slow templates, you may want to consider using a faster and lighter engine like Pongo2."]})}),"\n",(0,n.jsx)(t.h3,{id:"pongo2",children:"Pongo2"}),"\n",(0,n.jsxs)(t.p,{children:["Documentation: ",(0,n.jsx)(t.a,{href:"https://github.com/flosch/pongo2",children:"https://github.com/flosch/pongo2"})]})]})}function o(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(a,{...e})}):a(e)}},27069:(e,t,s)=>{s.d(t,{Z:()=>n});const n=s.p+"assets/images/template-engines-alternatives-e6c2c05b583a00f955b9a6d3138e241a.png"},11151:(e,t,s)=>{s.d(t,{a:()=>d});var n=s(67294);const r={},i=n.createContext(r);function d(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}}}]);